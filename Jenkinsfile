pipeline {
    agent any

    stages {
         stage('To check whether PR Raised on Develop Branch') {
            steps {
                script {
                       def response =[{issue_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/issues/47, _links={comments={href=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/issues/47/comments}, issue={href=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/issues/47}, self={href=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/pulls/47}, review_comments={href=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/pulls/47/comments}, commits={href=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/pulls/47/commits}, statuses={href=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/statuses/b0b900c888069a27acbcc38c13324a2b5a3d46de}, html={href=https://github.anaplan.com/core-platform/core-sizing/pull/47}, review_comment={href=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/pulls/comments{/number}}}, diff_url=https://github.anaplan.com/core-platform/core-sizing/pull/47.diff, created_at=2023-12-11T10:44:10Z, assignees=[], requested_reviewers=[], title=NIBB-106 Add Auth0 secret to mvn smoke tests, body=It's your last day.  Seems right to give you an in depth code review to do just so your name will appear against something else in Anaplan for eternity! :o)
, requested_teams=[], head={ref=task/NIBB-106, repo={allow_forking=true, stargazers_count=1, is_template=false, pushed_at=2023-12-27T13:56:32Z, subscription_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/subscription, language=Java, branches_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/branches{/branch}, issue_comment_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/issues/comments{/number}, labels_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/labels{/name}, subscribers_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/subscribers, releases_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/releases{/id}, svn_url=https://github.anaplan.com/core-platform/core-sizing, id=8931, has_discussions=false, forks=0, archive_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/{archive_format}{/ref}, git_refs_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/git/refs{/sha}, forks_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/forks, visibility=private, statuses_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/statuses/{sha}, ssh_url=git@github.anaplan.com:core-platform/core-sizing.git, license=null, full_name=core-platform/core-sizing, size=168307, languages_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/languages, html_url=https://github.anaplan.com/core-platform/core-sizing, collaborators_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/collaborators{/collaborator}, clone_url=https://github.anaplan.com/core-platform/core-sizing.git, name=core-sizing, pulls_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/pulls{/number}, default_branch=develop, hooks_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/hooks, trees_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/git/trees{/sha}, tags_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/tags, private=true, contributors_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/contributors, has_downloads=true, notifications_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/notifications{?since,all,participating}, open_issues_count=2, description=null, created_at=2023-01-09T15:07:44Z, watchers=1, keys_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/keys{/key_id}, deployments_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/deployments, has_projects=false, archived=false, has_wiki=true, updated_at=2023-09-29T12:40:45Z, comments_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/comments{/number}, stargazers_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/stargazers, disabled=false, git_url=git://github.anaplan.com/core-platform/core-sizing.git, has_pages=false, owner={gists_url=https://github.anaplan.com/api/v3/users/core-platform/gists{/gist_id}, repos_url=https://github.anaplan.com/api/v3/users/core-platform/repos, following_url=https://github.anaplan.com/api/v3/users/core-platform/following{/other_user}, starred_url=https://github.anaplan.com/api/v3/users/core-platform/starred{/owner}{/repo}, login=core-platform, followers_url=https://github.anaplan.com/api/v3/users/core-platform/followers, type=Organization, url=https://github.anaplan.com/api/v3/users/core-platform, subscriptions_url=https://github.anaplan.com/api/v3/users/core-platform/subscriptions, received_events_url=https://github.anaplan.com/api/v3/users/core-platform/received_events, avatar_url=https://github.anaplan.com/avatars/u/92?, events_url=https://github.anaplan.com/api/v3/users/core-platform/events{/privacy}, html_url=https://github.anaplan.com/core-platform, site_admin=false, id=92, gravatar_id=, node_id=MDEyOk9yZ2FuaXphdGlvbjky, organizations_url=https://github.anaplan.com/api/v3/users/core-platform/orgs}, commits_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/commits{/sha}, compare_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/compare/{base}...{head}, git_commits_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/git/commits{/sha}, topics=[], blobs_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/git/blobs{/sha}, git_tags_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/git/tags{/sha}, merges_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/merges, downloads_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/downloads, has_issues=true, web_commit_signoff_required=false, url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing, contents_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/contents/{+path}, mirror_url=null, milestones_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/milestones{/number}, teams_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/teams, fork=false, issues_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/issues{/number}, events_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/events, issue_events_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/issues/events{/number}, assignees_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/assignees{/user}, open_issues=2, watchers_count=1, node_id=MDEwOlJlcG9zaXRvcnk4OTMx, homepage=null, forks_count=0}, label=core-platform:task/NIBB-106, sha=b0b900c888069a27acbcc38c13324a2b5a3d46de, user={gists_url=https://github.anaplan.com/api/v3/users/core-platform/gists{/gist_id}, repos_url=https://github.anaplan.com/api/v3/users/core-platform/repos, following_url=https://github.anaplan.com/api/v3/users/core-platform/following{/other_user}, starred_url=https://github.anaplan.com/api/v3/users/core-platform/starred{/owner}{/repo}, login=core-platform, followers_url=https://github.anaplan.com/api/v3/users/core-platform/followers, type=Organization, url=https://github.anaplan.com/api/v3/users/core-platform, subscriptions_url=https://github.anaplan.com/api/v3/users/core-platform/subscriptions, received_events_url=https://github.anaplan.com/api/v3/users/core-platform/received_events, avatar_url=https://github.anaplan.com/avatars/u/92?, events_url=https://github.anaplan.com/api/v3/users/core-platform/events{/privacy}, html_url=https://github.anaplan.com/core-platform, site_admin=false, id=92, gravatar_id=, node_id=MDEyOk9yZ2FuaXphdGlvbjky, organizations_url=https://github.anaplan.com/api/v3/users/core-platform/orgs}}, author_association=CONTRIBUTOR, number=47, patch_url=https://github.anaplan.com/core-platform/core-sizing/pull/47.patch, updated_at=2023-12-11T12:05:25Z, draft=false, merge_commit_sha=b66220eee70ac84de4cfed8454534b4d18df24ba, comments_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/issues/47/comments, review_comment_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/pulls/comments{/number}, active_lock_reason=null, id=273992, state=closed, locked=false, commits_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/pulls/47/commits, closed_at=2023-12-11T12:05:25Z, statuses_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/statuses/b0b900c888069a27acbcc38c13324a2b5a3d46de, merged_at=2023-12-11T12:05:25Z, auto_merge=null, url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/pulls/47, labels=[], milestone=null, html_url=https://github.anaplan.com/core-platform/core-sizing/pull/47, review_comments_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/pulls/47/comments, assignee=null, user={gists_url=https://github.anaplan.com/api/v3/users/cliff-evans/gists{/gist_id}, repos_url=https://github.anaplan.com/api/v3/users/cliff-evans/repos, following_url=https://github.anaplan.com/api/v3/users/cliff-evans/following{/other_user}, starred_url=https://github.anaplan.com/api/v3/users/cliff-evans/starred{/owner}{/repo}, login=cliff-evans, followers_url=https://github.anaplan.com/api/v3/users/cliff-evans/followers, type=User, url=https://github.anaplan.com/api/v3/users/cliff-evans, subscriptions_url=https://github.anaplan.com/api/v3/users/cliff-evans/subscriptions, received_events_url=https://github.anaplan.com/api/v3/users/cliff-evans/received_events, ldap_dn=uid=cliff.evans,ou=people,dc=anaplan,dc=io, avatar_url=https://github.anaplan.com/avatars/u/183?, events_url=https://github.anaplan.com/api/v3/users/cliff-evans/events{/privacy}, html_url=https://github.anaplan.com/cliff-evans, site_admin=false, id=183, gravatar_id=, node_id=MDQ6VXNlcjE4Mw==, organizations_url=https://github.anaplan.com/api/v3/users/cliff-evans/orgs}, node_id=MDExOlB1bGxSZXF1ZXN0MjczOTky, base={ref=develop, repo={allow_forking=true, stargazers_count=1, is_template=false, pushed_at=2023-12-27T13:56:32Z, subscription_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/subscription, language=Java, branches_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/branches{/branch}, issue_comment_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/issues/comments{/number}, labels_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/labels{/name}, subscribers_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/subscribers, releases_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/releases{/id}, svn_url=https://github.anaplan.com/core-platform/core-sizing, id=8931, has_discussions=false, forks=0, archive_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/{archive_format}{/ref}, git_refs_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/git/refs{/sha}, forks_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/forks, visibility=private, statuses_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/statuses/{sha}, ssh_url=git@github.anaplan.com:core-platform/core-sizing.git, license=null, full_name=core-platform/core-sizing, size=168307, languages_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/languages, html_url=https://github.anaplan.com/core-platform/core-sizing, collaborators_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/collaborators{/collaborator}, clone_url=https://github.anaplan.com/core-platform/core-sizing.git, name=core-sizing, pulls_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/pulls{/number}, default_branch=develop, hooks_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/hooks, trees_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/git/trees{/sha}, tags_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/tags, private=true, contributors_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/contributors, has_downloads=true, notifications_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/notifications{?since,all,participating}, open_issues_count=2, description=null, created_at=2023-01-09T15:07:44Z, watchers=1, keys_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/keys{/key_id}, deployments_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/deployments, has_projects=false, archived=false, has_wiki=true, updated_at=2023-09-29T12:40:45Z, comments_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/comments{/number}, stargazers_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/stargazers, disabled=false, git_url=git://github.anaplan.com/core-platform/core-sizing.git, has_pages=false, owner={gists_url=https://github.anaplan.com/api/v3/users/core-platform/gists{/gist_id}, repos_url=https://github.anaplan.com/api/v3/users/core-platform/repos, following_url=https://github.anaplan.com/api/v3/users/core-platform/following{/other_user}, starred_url=https://github.anaplan.com/api/v3/users/core-platform/starred{/owner}{/repo}, login=core-platform, followers_url=https://github.anaplan.com/api/v3/users/core-platform/followers, type=Organization, url=https://github.anaplan.com/api/v3/users/core-platform, subscriptions_url=https://github.anaplan.com/api/v3/users/core-platform/subscriptions, received_events_url=https://github.anaplan.com/api/v3/users/core-platform/received_events, avatar_url=https://github.anaplan.com/avatars/u/92?, events_url=https://github.anaplan.com/api/v3/users/core-platform/events{/privacy}, html_url=https://github.anaplan.com/core-platform, site_admin=false, id=92, gravatar_id=, node_id=MDEyOk9yZ2FuaXphdGlvbjky, organizations_url=https://github.anaplan.com/api/v3/users/core-platform/orgs}, commits_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/commits{/sha}, compare_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/compare/{base}...{head}, git_commits_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/git/commits{/sha}, topics=[], blobs_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/git/blobs{/sha}, git_tags_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/git/tags{/sha}, merges_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/merges, downloads_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/downloads, has_issues=true, web_commit_signoff_required=false, url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing, contents_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/contents/{+path}, mirror_url=null, milestones_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/milestones{/number}, teams_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/teams, fork=false, issues_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/issues{/number}, events_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/events, issue_events_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/issues/events{/number}, assignees_url=https://github.anaplan.com/api/v3/repos/core-platform/core-sizing/assignees{/user}, open_issues=2, watchers_count=1, node_id=MDEwOlJlcG9zaXRvcnk4OTMx, homepage=null, forks_count=0}, label=core-platform:develop, sha=04a23aae095b1bd582d433af503b25108d9cd725, user={gists_url=https://github.anaplan.com/api/v3/users/core-platform/gists{/gist_id}, repos_url=https://github.anaplan.com/api/v3/users/core-platform/repos, following_url=https://github.anaplan.com/api/v3/users/core-platform/following{/other_user}, starred_url=https://github.anaplan.com/api/v3/users/core-platform/starred{/owner}{/repo}, login=core-platform, followers_url=https://github.anaplan.com/api/v3/users/core-platform/followers, type=Organization, url=https://github.anaplan.com/api/v3/users/core-platform, subscriptions_url=https://github.anaplan.com/api/v3/users/core-platform/subscriptions, received_events_url=https://github.anaplan.com/api/v3/users/core-platform/received_events, avatar_url=https://github.anaplan.com/avatars/u/92?, events_url=https://github.anaplan.com/api/v3/users/core-platform/events{/privacy}, html_url=https://github.anaplan.com/core-platform, site_admin=false, id=92, gravatar_id=, node_id=MDEyOk9yZ2FuaXphdGlvbjky, organizations_url=https://github.anaplan.com/api/v3/users/core-platform/orgs}}}]

                    
                }]
                  def prDetailsList = readJSON text: response[0]
                   if (prDetailsList && prDetailsList.size() > 0 && prDetailsList[0].base.ref=="develop"){
                        PR_ON_DEVELOP=true;
                        echo "PR Details: ${PR_ON_DEVELOP}"
                    }

            }
        }
         }
    }
}
        // stage('Get Pull Request for Commit') {
        //     steps {
        //         script {
        //             def githubToken = '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'
        //             def repoOwner = 'abhigyanr8'
        //             def repoName = 'Jenkins_Branch_Stage'
        //             def commitSha = '4faf09a2fca5f88905542274bc2508'

        //             def apiUrl = "  https://api.github.com/repos/abhigyanr8/Jenkins_Branch_Stage/commits/3cdbcaf/pulls"
                    
        //             def response
                    
        //              response = bat(script: """
        //                 curl -X GET ${apiUrl}
        //             """, returnStdout: true).trim()
        //             echo "Raw response: ${response}" 
        //             // Print the raw response for debugging

        //             def jsonResponse = response.substring(response.indexOf("["))
        //            echo "Raw response: ${jsonResponse}"
                  

        //             try {
        //                  def parser = new groovy.json.JsonSlurper()
        //                  def pullRequests = parser.parseText(jsonResponse)
        //                 // Try parsing the JSON string
        //               // def pullRequests = new groovy.json.JsonSlurper().parseText(response)


        //                 if (pullRequests.size() > 0) {
        //                     def prNumber = pullRequests[0].number
        //                     def branch = pullRequests[0].base.ref
        //                     echo "Pull Request associated with commit: ${prNumber}"
        //                     echo "Base branch of pull request: ${branch}"
        //                 } else {
        //                     echo "No pull request found for the commit."
        //                 }
        //             } catch (Exception e) {
        //                 echo "Error parsing JSON: ${e.message}"
        //                 // Handle the exception or add more debugging information as needed
        //             }
        //         }
        //     }
        // }
    }
}
